<html>
<head>
<link rel='stylesheet' href='../css/style.css'>
<link rel='stylesheet' href='../node_modules/bootstrap/dist/css/bootstrap.css'>
<script type='text/javascript' src='../ggd3.standalone.js'></script></head>
</head>
<body>
<div>
  <select id="dataset" class='btn btn-primary'>
  <option value="mtcars.csv" id='cars' >cars</option>
  <option value="iris.csv" id='iris' >iris</option>
  <option value="diamonds.csv" id='diamonds' >diamonds</option>
  <option value="baseball.csv" id='baseball' selected>baseball</option>
  <option value="nelplo.csv" id='nelplo' >nelplo</option>
  <option value="wells.csv" id='wells' >wells</option>
  <option value="ustimeseries.csv" id='ustimeseries' >ustimeseries</option>
</select>
<!-- <select id="xVar" class='btn btn-primary'>
</select>    
<select id="yVar" class='btn btn-primary'>
</select>    
 -->
<select id="facet-scales" class='btn btn-primary'>
  <option value="fixed" id="fixed" selected>fixed</option>
  <option value="free" id="free" >free</option>
  <option value="free_x" id="free_x" >free x</option>
  <option value="free_y" id="free_y" >free y</option>
</select>    
<!-- <select id="xAxisPos" class='btn btn-primary'>
  <option value="bottom" selected>x axis bottom</option>
  <option value="top">x axis top</option>
</select>    
<select id="yAxisPos" class='btn btn-primary'>
  <option value="left" selected>y axis left</option>
  <option value="right">y axis right</option>
</select>    
 -->
</div>
<div id='chart01' class='chart-frame'></div>
<script>
var ch;
var div = d3.select('#chart01')
$("#dataset").on('change', function() {
  redraw()
})
$("#facet-scales").on('change', function() {
  redraw()
})
var facets = {'mtcars.csv': {"x": "gear", y: "am"},
            "iris.csv" : {'y': "Species", ncols: 3},
            "diamonds.csv": {"x": "color", "y": "cut"},
            "baseball.csv": {"x": "decade", "y": "team"},
            "nelplo.csv": {x: 'group', ncols: 3},
            "ustimeseries.csv": {x: 'group', nrows:3},
            "wells.csv": {x: 'switch', nrows:2}
          };
var aes = {'mtcars.csv': {"x": "mpg" , "y": "hp"},
            "iris.csv" : {'x': "Sepal.Length", "y": "Sepal.Width"},
            "diamonds.csv": {"x": "carat", "y": "clarity"},
            "baseball.csv": {"x": "year", "y": "h"},
            "nelplo.csv": {'x': 'date', 'y': 'value'},
            "ustimeseries.csv": {'x': 'date', 'y': 'value'},
            "wells.csv": {'x': 'arsenic', 'y': 'dist'}
          };
var dtypes = {'mtcars.csv': {"gear": ["string"]},
            "iris.csv" : {},
            "diamonds.csv": {},
            "baseball.csv": {"year": ['date', 'many', "%Y"]},
            "nelplo.csv": {"date": ['date', 'many']},
            "ustimeseries.csv": {"date": ['date', 'many']},
            "wells.csv": {},
          };
var FacetType = {'mtcars.csv': "grid",
            "iris.csv" : "wrap",
            "diamonds.csv": "grid",
            "baseball.csv": "grid",
            "nelplo.csv": "wrap",
            "ustimeseries.csv": "wrap",
            "wells.csv": "wrap",
          };
ch = new ggd3.plot()
          .layers(['bar'])
          .width(150)
          .height(300)
          .yScale({axis: {ticks: 4, position:'right',
                  "orient": "left"}})
          .margins({top: 5, bottom:20, left:2, right:2})
          .xScale({axis: {ticks: 4, position: "top",
                  "orient": "bottom"}})
          // .xAdjust(true);
// this should work;
function redraw() {
  var dataset = $("#dataset")[0].value;
  d3.csv("../data/" + dataset, function(error, data) {
  ch
    .dtypes(dtypes[dataset])
    .data(data)
    .aes(aes[dataset]);
    var facet = new ggd3.facet(facets[dataset])
                  .type(FacetType[dataset])
                  .scales($("#facet-scales")[0].value)
                  .titleProps([0.3, 0.1]);
    div.call(ch.facet(facet).draw());
  })
}
redraw();
</script>
</body>
</html>