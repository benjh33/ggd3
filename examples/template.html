<html>
<head>
<link rel='stylesheet' href='../css/style.css'>
<link rel='stylesheet' href='../node_modules/bootstrap/dist/css/bootstrap.css'>
<script type='text/javascript' src='../ggd3.standalone.js'></script></head>
</head>
<body>
<div>
  <select id="dataset" class='btn btn-primary'>
  <option value="mtcars.csv" id='cars' selected>cars</option>
  <option value="iris.csv" id='iris' >iris</option>
  <option value="diamonds.csv" id='diamonds' >diamonds</option>
  <option value="baseball.csv" id='baseball' >baseball</option>
  <option value="nelplo.csv" id='nelplo' >nelplo</option>
  <option value="wells.csv" id='wells' >wells</option>
  <option value="ustimeseries.csv" id='ustimeseries' >ustimeseries</option>
</select>
<!-- <select id="xVar" class='btn btn-primary'>
</select>    
<select id="yVar" class='btn btn-primary'>
</select>    
 -->
<select id="facet-scales" class='btn btn-primary'>
  <option value="fixed" id="fixed" selected>fixed</option>
  <option value="free" id="free" >free</option>
  <option value="free_x" id="free_x" >free x</option>
  <option value="free_y" id="free_y" >free y</option>
</select>    
<!-- <select id="xAxisPos" class='btn btn-primary'>
  <option value="bottom" selected>x axis bottom</option>
  <option value="top">x axis top</option>
</select>    
<select id="yAxisPos" class='btn btn-primary'>
  <option value="left" selected>y axis left</option>
  <option value="right">y axis right</option>
</select>    
 -->
</div>
<div id='chart01' class='chart-frame'></div>
<script>
var ch;
var div = d3.select('#chart01');
$("#dataset").on('change', function() {
  redraw();
});
$("#facet-scales").on('change', function() {
  redraw();
});
var facets = {'mtcars.csv': {"x": "gear", y: "am"},
            "iris.csv" : null,
            "diamonds.csv": {"x": "color", "y": "cut"},
            "baseball.csv": {"x": "decade", "y": "team"},
            "nelplo.csv": {x: 'group', ncols: 3},
            "ustimeseries.csv": {x: 'group', nrows:3},
            "wells.csv": {x: 'switch', y:'assoc'}
          };
var aes = {'mtcars.csv': {x: "mpg" , y: "hp", fill:"cyl", size:"drat",
              label:'gear'},
            "iris.csv" : {x: "Sepal.Length", y: "Sepal.Width"
            , fill: "Petal.Length", size: "Petal.Width"
          },
            "diamonds.csv": {x: "carat", y: "clarity"},
            "baseball.csv": {x: "hr", y: "h", fill: "hr", size: "g",
            label: 'id'
          },
            "nelplo.csv": {x: 'date', y: 'value', fill: 'variable'},
            "ustimeseries.csv": {x: 'date', y: 'value', fill: 'variable'},
            "wells.csv": {x: 'arsenic', y: 'dist', fill: "educ"}
          };
var dtypes = {'mtcars.csv': {"gear": ["string"]},
            "iris.csv" : {},
            "diamonds.csv": {},
            "baseball.csv": {"year": ['date', 'many', "%Y"]},
            "nelplo.csv": {"date": ['date', 'many']},
            "ustimeseries.csv": {"date": ['date', 'many']},
            "wells.csv": {},
          };
var FacetType = {'mtcars.csv': "grid",
            "iris.csv" : "wrap",
            "diamonds.csv": "grid",
            "baseball.csv": "grid",
            "nelplo.csv": "wrap",
            "ustimeseries.csv": "wrap",
            "wells.csv": "grid",
          };
var geom = {'mtcars.csv': ["point"],
            "iris.csv" : ["point"],
            "diamonds.csv": ["bar"],
            "baseball.csv": ["bar"],
            "nelplo.csv": ["point"],
            "ustimeseries.csv": ["point"],
            "wells.csv": ["point"],
          };
var layers = {'mtcars.csv': ['text'],
            "iris.csv" : ["point"],
            "diamonds.csv": "grid",
            "baseball.csv": ["point"],
            "nelplo.csv": ["point"],
            "ustimeseries.csv": ["point"],
            "wells.csv": ["point"],
          };
var charts = {'mtcars.csv': new ggd3.plot()
                    .width(300)
                    .height(300)
                    .yScale({type: 'log', 
                            axis: {ticks: 4, 
                              position:'right',
                              tickFormat: d3.format(",.0f"),
                              orient: "left"}})
                    .margins({top: 5, bottom:10, left:2, right:2})
                    .xScale({type: 'log',
                            axis: {ticks: 4, 
                            tickFormat: d3.format(",.0f"),
                            position: "top",
                            orient: "bottom"}})
                    .layers(layers["mtcars.csv"]),
            "iris.csv" : new ggd3.plot()
                                .layers(layers["iris.csv"])
                                .width(500)
                                .height(450)
                                .yScale({type: 'log', axis: {ticks: 4, position:'left',
                                  orient: "left"}})
                                .margins({top: 5, bottom:20, left:25, right:5})
                                .xScale({type:'log', axis: {ticks: 4, position: "bottom",
                                        "orient": "bottom"}}),
            "diamonds.csv": new ggd3.plot()
                                .layers(layers["diamonds.csv"])
                                .width(150)
                                .height(150)
                                .yScale({axis: {ticks: 4, position:'right',
                                        "orient": "left"}})
                                .margins({top: 5, bottom:20, left:2, right:2})
                                .xScale({axis: {ticks: 4, position: "top",
                                        "orient": "bottom"}}),
            "baseball.csv": new ggd3.plot()
                                .layers(layers["baseball.csv"])
                                .width(300)
                                .height(300)
                                .sizeRange([5, 20])
                                .yScale({axis: {ticks: 4, position:'right',
                                        "orient": "left"}})
                                .margins({top: 10, bottom:20, left:2, right:2})
                                .xScale({axis: {ticks: 4, position: "top",
                                        "orient": "bottom"}}),
            "nelplo.csv": new ggd3.plot()
                                .layers(layers["nelplo.csv"])
                                .width(300)
                                .height(150)
                                .yScale({axis: {ticks: 4, position:'left',
                                        "orient": "left"}})
                                .margins({top: 15, bottom:20, left:20, right:5})
                                .xScale({axis: {ticks: 4, position: "bottom",
                                        "orient": "bottom"}}),
            "ustimeseries.csv": new ggd3.plot()
                                .layers(layers["ustimeseries.csv"])
                                .width(500)
                                .height(300)
                                .yScale({axis: {ticks: 4, position:'left',
                                        "orient": "left"}})
                                .margins({top: 5, bottom:10, left:30, right:2})
                                .xScale({axis: {ticks: 4, position: "top",
                                        "orient": "bottom"}}),
            "wells.csv": new ggd3.plot()
                                .width(400)
                                .height(400)
                                .yScale({type:'log', 
                                        axis: {ticks: 4, 
                                          tickFormat: d3.format(",.0f"),
                                          position:'right',
                                        orient: "left"}})
                                .layers(layers["wells.csv"])
                                .margins({top: 5, bottom:20, left:2, right:2})
                                .xScale({type: 'log', 
                                        axis: {ticks: 4, 
                                          tickFormat: d3.format(",.0f"),
                                          position: "top",
                                          orient: "bottom"}}),
          };

// this should work;
var chart;
function redraw() {
  var dataset = $("#dataset")[0].value;
  d3.csv("../data/" + dataset, function(error, data) {
  chart = charts[dataset]
                .dtypes(dtypes[dataset])
                .data(data)
                .aes(aes[dataset]);
    var facet = new ggd3.facet(facets[dataset])
                  .type(FacetType[dataset])
                  .scales($("#facet-scales")[0].value)
                  // .titleProps([0.1, 0.1]);
    div.call(chart.facet(facet).draw());
  })
}
redraw();
</script>
</body>
</html>